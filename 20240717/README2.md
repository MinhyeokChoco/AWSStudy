# CI/CD
> Continuous Integration, Continuous Deployment
> Ïö∞Î¶¨Í∞Ä ÏΩîÎìúÎ•º ÍπÉÏóê Ìë∏Ïâ¨, ÌíÄ Î∞õÏïÑÏÑú ÏÑúÎ≤Ñ ÎåÄÍ∏∞ ÏÉÅÌÉú
> ÏâΩÍ≤å ÎßêÌï¥ÏÑú ÌÖåÏä§Ìä∏(Test), ÌÜµÌï©(Merge), Î∞∞Ìè¨(Deploy)Î•º ÏûêÎèôÌôî

## CI/CD Í≥ºÏ†ï
ÏûëÏóÖÏûê > Ïª§Î∞ã, Ìë∏Ïâ¨ > ÎπåÎìú ÌÖåÏä§Ìä∏ > Î∞∞Ìè¨

> ÏûëÏóÖÏûêÍ∞Ä Ïª§Î∞ã, Ìë∏Ïâ¨ ÌïòÎ©¥
> Ìë∏Ïâ¨ Ïù¥Î≤§Ìä∏ Î∞úÏÉùÏùÑ ÌôïÏù∏ÌïòÍ≥† ÌÖåÏä§Ìä∏ ÌõÑ ÎπåÎìú ÎßåÎì§Ïñ¥ÏÑú ÏÑúÎ≤ÑÏóê Î∞∞Ìè¨, Ïö¥ÏòÅ, Í¥ÄÎ¶¨ ÏßÑÌñâ

## ÏÑúÎπÑÏä§Î•º Ïö¥ÏòÅ
> ÏÑúÎπÑÏä§Î•º Ïö¥ÏòÅ, Î∞∞Ìè¨ ÌïòÎã§ Î≥¥Î©¥ Í∏∞Îä•Ïù¥ Î≤àÎ≤àÌûà ÏÉàÎ°úÏö¥ Í∏∞Îä•Ïù¥ Ï∂îÍ∞ÄÎêòÎäîÎç∞ ÌòπÏùÄ ÏóÖÎç∞Ïù¥Ìä∏Í∞Ä ÎêòÎäîÎç∞
> Ïö∞Î¶¨Í∞Ä ÏÉàÎ°ú ÏûëÏÑ±ÌïòÎäî ÏΩîÎìúÎ•º Ïª§Î∞ã Ìë∏Ïâ¨, ÌíÄ / Î∏åÎü∞ÏπòÏóêÏÑú Î≥ëÌï©ÏùÑ ÌïòÍ≥† AWS Í∞ÄÏÉÅ ÏÑúÎ≤ÑÏóê ÏΩîÎìú ÎÇ¥Ïö©ÏùÑ Î∞õÍ≥† ÏâòÎ°ú Îã§Ïãú Ïã§ÌñâÌïòÍ≥† ÌïòÎ©¥ Î≤àÍ±∞Î°≠Í≥† Í∑ÄÏ∞ÆÎã§.

> Í∑∏ÎûòÏÑú Î≤àÍ±∞Î°úÏö¥ ÏóÖÎ¨¥Î•º ÏûêÎèôÌôî ÏãúÌÇ§Í≥† Í∞úÎ∞úÏóêÎßå ÏßëÏ§ë ÌïòÏûê ÎùºÎäî Ï∑®ÏßÄÎ°ú

## ÏûêÎèôÌôî
> ÏúÑÏùò Í≥ºÏ†ïÏù¥ ÎÑàÎ¨¥ Î≤àÍ±∞Î°≠Í∏∞ ÎïåÎ¨∏Ïóê Ïù¥Îü∞ Î∞òÎ≥µÎêòÎäî Í≥ºÏ†ïÏùÑ ÏûêÎèôÌôî ÏãúÌÇ® Í≤É.

## github-Actions
> Ïö∞Î¶¨Îäî CI/CD ÌôòÍ≤Ω Íµ¨Ï∂ïÏùÑ ÎπåÎìú ÏÑúÎ≤ÑÎèÑ Ï†úÍ≥µÌï¥Ï£ºÍ≥† Î¨¥Î£åÏù∏ github-actions
- Ïû•Ï†ê
    1. ÎπåÎìúÏö© ÏÑúÎ≤ÑÍ∞Ä Îî∞Î°ú ÌïÑÏöî ÏóÜÏùå(ÎπåÎìú ÏÑúÎ≤Ñ ÏÑ∏ÌåÖÏúºÎ°ú ÏãúÍ∞ÑÍ≥º ÎèàÏùÑ Ïì∏ ÌïÑÏöîÍ∞Ä ÏóÜÎã§.) Ïö∞Î∂ÑÌà¨ ÌôòÍ≤ΩÏùÑ Ï†úÍ≥µÌï¥Ï§ÄÎã§. Ïù∏Ïä§ÌÑ¥Ïä§ÏóêÏÑú ÎπåÎìúÎ•º Ìï† Îïå Î©îÎ™®Î¶¨Í∞Ä Î∂ÄÏ°±Ìïú Î¨∏Ï†úÎèÑ ÎπåÎìúÎ•º Ìï¥ÏÑú ÎπåÎìú ÌååÏùºÏùÑ Ïò¨Î¶¨Í≤å ÎêòÎ©¥ Î©îÎ™®Î¶¨Î•º Ï†àÏïΩÌï† Ïàò ÏûàÎã§. Ï¶â ÎèàÏùÑ Ï†àÏïΩÌï† Ïàò ÏûàÎã§.
    2. githubÏôÄ ÌÜµÏùºÎêú ÌôòÍ≤ΩÏóêÏÑú CIÍ∞Ä ÏàòÌñâÏù¥ Í∞ÄÎä•ÌïòÎã§.
    3. Yaml ÌååÏùºÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Í∞ÑÎã®ÌïòÍ≤å Î°úÏßÅÏùÑ ÏûëÏÑ±Ìï† Ïàò ÏûàÎã§. runner Í∞ÄÏÉÅ Î®∏Ïã†
    4. Yaml ÌååÏùºÎ°ú Í∞ÑÎã®Ìïú ÌååÏù¥ÌîÑ ÎùºÏù∏ Íµ¨ÏÑ±
    > `ÌååÏù¥ÌîÑ ÎùºÏù∏` : ÏûëÏóÖÎì§ÏùÑ ÏàúÏ∞®Ï†ÅÏúºÎ°ú ÏàòÌñâÌïòÎäî Í≤É.
    > ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ Í∞úÎ∞úÏóêÏÑú ÏΩîÎìúÎ•º ÎπåÎìúÌïòÍ≥† ÌÖåÏä§Ìä∏ÌïòÍ≥† Î∞∞Ìè¨ ÌïòÎäî Îã®Í≥ÑÎ•º ÏûêÎèôÌôîÌïú ÌùêÎ¶Ñ

CI/CDÏùò ÌååÏù¥ÌîÑ ÎùºÏù∏ÏùÄ ÏûëÏóÖÏùÑ ÏûêÎèôÌôîÌïòÍ≥† Í∞úÎ∞úÏùò ÏÜçÎèÑ Ï¶ùÏßÑ Î∞è ÌíàÏßàÏù¥ Ï¢ãÎã§.

1. ÏΩîÎìú Ïª§Î∞ã, Ìë∏Ïâ¨
2. Ìë∏Ïâ¨ Ïù¥Î≤§Ìä∏Î•º Î≥¥Í≥† CI ÏÑúÎ≤Ñ Ìä∏Î¶¨Í±∞ Ìò∏Ï∂ú
3. ÏΩîÎìú ÎπåÎìú
4. ÏûêÎèôÌôî ÌÖåÏä§Ìä∏ Ïã§Ìñâ
5. Î∞∞Ìè¨ Ï§ÄÎπÑ
6. Î∞∞Ìè¨
7. Î™®ÎãàÌÑ∞ÎßÅ

## github ActionÏùò Í∞ÄÏÉÅ Î®∏Ïã† Íµ¨Ï°∞
> ÏΩîÎìú Ïª§Î∞ã, Ìë∏Ïâ¨ -> Ìë∏Ïâ¨ Ïù¥Î≤§Ìä∏Î•º github actionsÍ∞Ä Í∞êÏßÄÌïòÍ≥† CI/CD Î°úÏßÅ Ïã§Ìñâ -> Î∞∞Ìè¨(AWS)

> Ïù¥Îü∞ ÎπåÎìú ÌÖåÏä§Ìä∏ Î∞∞Ìè¨ ÏûëÏóÖÏùÑ github actionsÎäî Îü¨ÎÑà ÎùºÍ≥† Î∂ÄÎ•¥Îäî Í∞ÄÏÉÅÎ®∏Ïã†Ïù¥ Ïª®ÌÖåÏù¥ÎÑàÏóêÏÑú Ïã§ÌñâÎêúÎã§.
> github actionsÏùò Îü¨ÎÑàÎäî Î≥ÑÎèÑÏùò ÏÑúÎ≤Ñ ÏóÜÏù¥ ÏûêÎèôÌôî ÏûëÏóÖÏùÑ Ï†úÍ≥µÌïúÎã§.
> Îü¨ÎÑàÎäî ÏÇ¨Ïö©ÏûêÍ∞Ä ÏõêÌïòÎäî Ïö¥ÏòÅÏ≤¥Ï†úÎ•º Ï†úÍ≥µÌïúÎã§. ex = ÏúàÎèÑÏö∞, Îß• OS, Î¶¨ÎàÖÏä§, Ïö∞Î∂ÑÌà¨ Îì±
> `ÏûêÎèô Ïä§ÏºÄÏùºÎßÅ` ÏúºÎ°ú Î¶¨ÏÜåÏä§Î•º Ìö®Ïú®Ï†ÅÏúºÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎã§.
> NodeJS, Python, Java Îì±Ïùò Îü∞ÌÉÄÏûÑ ÌôòÍ≤ΩÏù¥ ÏÑ§ÏπòÎêòÏñ¥ ÏûàÎã§, Îπ†Î•¥Í≤å ÎπåÎìú ÌÖåÏä§Ìä∏Í∞Ä Í∞ÄÎä•ÌïòÎã§.

`ÏûêÎèô Ïä§ÏºÄÏùºÎßÅ`ÏùÄ ÌÅ¥ÎùºÏö∞Îìú Ïª¥Ìì®ÌåÖ ÌôòÍ≤ΩÏóêÏÑú ÏÇ¨Ïö©ÎêòÎäî Í∏∞Ïà†, Ïª¥Ìì®ÌåÖ ÏûêÏõêÏùò ÏñëÏùÑ ÏûêÎèôÏúºÎ°ú Ï°∞Ï†ïÌï† Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏ÌïúÎã§.

## Ìè¥Îçî Íµ¨Ï°∞
> ÍπÉÏùò ÏõêÍ≤© Ïª§Î∞ãÍ≥º Ìë∏Ïâ¨Î•º Ìï† Îïå
.github
- workflows
-- yml ÌååÏùºÏùÑ ÌïòÎÇò ÎßåÎì§Ïñ¥Ïïº ÌïúÎã§.

## github Action ÏÇ¨Ïö©
```yml
name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."
```

## aws EC2Ïóê Ïâò Ïä§ÌÅ¨Î¶ΩÌä∏Î•º Ïã§Ìñâ
> EC2Ïóê ssh Ïª§ÎÑ•ÏÖòÏùÑ Îß∫Í≥† Ïâò Ïä§ÌÅ¨Î¶ΩÌä∏ Ïã§Ìñâ

```yml
name : CI/CD Íµ¨Ï∂ï

on :
    push :
        branches :
            - main

jobs :
    deploy :
        runs-on : ubuntu-latest

    steps :
        - name : checkout
          uses : actions/checkout@v4 # uses ÏÇ¨Ïö©Ìï† ÎùºÏù¥Î∏åÎü¨Î¶¨

        - name : ssh key
          uses : webfactory/ssh-agent@v0.5.3
          with : # ÏûëÏÑ±Ìï† ÏÜçÏÑ±ÏùÑ Ï†ïÏùòÌïúÎã§.
            ssh-private-key: ${{ secrets.AWS_SECRET_KEY }} # Ïù¥Í≤ÉÏùÄ Ï†ïÌï¥Ï†∏ ÏûàÎäî ÌÇ§Í∞íÏûÑ, ssh Ïó∞Í≤∞ ÌïòÍ∏∞ ÏúÑÌï¥ Í∞ÄÏ†∏Ïò¨ ÌÇ§ Í∞í

        - name : ssh EC2 Ï†ëÏÜç
          uses : appleboy/ssh-action@v1.0.3
          with :
            host : ${{ secrets.HOST }}
            username : ${{ secrets.USERNAME }}
            key : ${{ secrets.AWS_SECRET_KEY }}
            port : ${{ secrets.PORT }}
            script : | # Ïã§ÌñâÌï† Ïä§ÌÅ¨Î¶ΩÌä∏ / | => Ï§Ñ ÎÇ¥Î¶º Í∏∞Ìò∏
                cd /home/ubuntu
                npm start
```

--------------------------------------------------------------------

```yml

# Í∏∞Î≥∏ ÏòàÏãú
name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."

```

--------------------------------------------------------------------------------------


# ÏòàÏãúÎ•º Ï∞∏Í≥† ÌõÑ ÏßÅÏ†ë ÏûëÏÑ±
```yml
name : CI/CD Íµ¨Ï∂ï

# Ïù¥Î≤§Ìä∏Î•º Íµ¨ÎèÖ
on : 
  push : # push Ïù¥Î≤§Ìä∏Í∞Ä Î∞úÏÉùÌïòÎ©¥ Ïã§Ìñâ
    branches : # pushÍ∞Ä Î∞úÏÉùÌïú Î∏åÎûúÏπòÍ∞Ä Î≠êÏùº Îïå Ïã§ÌñâÌï† ÏßÄ 
      - main

jobs : # ÏûëÏóÖÏùò Îã®ÏúÑ
  myTest : # ÏãùÎ≥ÑÏûê Ïù¥Î¶Ñ(Ïö∞Î¶¨Í∞Ä Ïù¥Î¶Ñ Ï†ïÌï¥ÎèÑ Îê®)
    runs-on : ubuntu-latest # ÏÇ¨Ïö©Ìï† Ïö¥ÏòÅÏ≤¥Ï†ú, 'latest' = ÏµúÏã†Î≤ÑÏ†ÑÏù¥ÎùºÎäî Îúª

    # ÏûëÏóÖÏùò Í∞ÄÏû• ÏûëÏùÄ Îã®ÏúÑ
    steps :
      - name : shell console test # Í∞ÄÏû• ÏûëÏùÄ ÏûëÏóÖ Îã®ÏúÑÏùò Ïù¥Î¶Ñ
        run : echo 'my CI/CD' # ÏûëÏóÖÏóêÏÑú Ïã§ÌñâÌï† Ïâò Ïä§ÌÅ¨Î¶ΩÌä∏ ÎÇ¥Ïö©, console.log()ÏôÄ ÎèôÏùº (Ï∂úÎ†• Î™ÖÎ†πÏñ¥)

      - name : mykey # Ïù¥Î¶ÑÏùÄ mykey
        run : echo ${{ secrets.HOST }}
```

---------------------------------------------------------------------

# Í≥µÎ∂Ä ÎÇ¥Ïö©
```yml
name : CI/CD Íµ¨Ï∂ï

on:
  push:
    branches:
      - main

jobs:
  deploy:
      runs-on: ubuntu-latest

      steps:
        - name: checkout
          uses: actions/checkout@v4 # uses ÏÇ¨Ïö©Ìï† ÎùºÏù¥Î∏åÎü¨Î¶¨

        - name: ssh ec2 Ï†ëÏÜç
          uses: appleboy/ssh-action@v1.0.3
          with: 
            host: ${{ secrets.HOST }}
            username: ${{ secrets.USERNAME }}
            key: ${{ secrets.AWS_SECRET_KEY }}
            port: ${{ secrets.PORT }}
            script: | # Ïã§ÌñâÌï† Ïä§ÌÅ¨Î¶ΩÌä∏
                cd /home/ubuntu/myapp
                git pull origin main
                pm2 kill
                npm start
```

## Ï∞ê ÏµúÏ¢Ö NestJs ÎπåÎìúÌï¥ÏÑú, ÎπåÎìú ÌååÏùºÎßå Ïò¨Î¶¨Í≥† Ï§ëÎã® ÌïòÏßÄ ÏïäÍ≥† Î∞∞Ìè¨
```yml
name : last nest deploy

on :
  push :
    branches :
      - main

jobs :
  build :
    runs-on : ubuntu-latest

    steps :
      - name : checkout
        uses : actions/checkout@v4

      - name : set up node
        uses : actions/setup-node@v4
        with :
          node-version : '20' # "node-version" Ïù¥Í≤å ÏûàÏúºÎ©¥ "npm audit fix || true" Î≤ÑÏ†ÑÏùÑ ÏßÄÏ†ïÌï¥Ï§¨Í∏∞ ÎïåÎ¨∏Ïóê ÏùòÏ°¥ÏÑ± Ïú†Ïó∞ÌïòÍ≤å Ìï¥Ï£ºÎäî Í∏∞Îä•Ïù¥ ÌïÑÏöîÍ∞Ä ÏóÜÏùå

      # - name : create .env
      #   run  : |
      #     "${{ secrets.MY_KEY }}" > .env

      - name : npm install # ÏùòÏ°¥ÏÑ± ÏÑ§Ïπò / "npm audit fix || true" : Î≥¥Ïïà Ï∑®ÏïΩÏ†êÏùÑ ÏûêÎèôÏúºÎ°ú Ïú†Ïó∞ÌïòÍ≤å ÏàòÏ†ïÌï¥ÏÑú Ïã§Ìå®Ìï¥ÎèÑ ÏùºÎã® ÎπåÎìú ÏßÑÌñâ ÌïòÎ©¥ÏÑú ÏùòÏ°¥ÏÑ± Ïú†Ïó∞ÌïòÍ≤å ÏÑ§Ïπò
        run  : |
          npm install

      - name : build NestJS
        run  : |
          npm run build

      - name : build output # ÎπåÎìúÍ∞Ä Ïûò ÎêòÏóàÎäîÏßÄ Î™®ÎãàÌÑ∞ÎßÅ / "ls -la dist" : dist Ìè¥Îçî ÏïàÏùò ÎÇ¥Ïö©ÏùÑ ÏÉÅÏÑ∏ÌïòÍ≤å Ï∂úÎ†•, pwd ÌòÑÏû¨ ÏûëÏóÖ Í≤ΩÎ°ú Ï∂úÎ†•
        run  : |
          ls -la dist
          pwd

      - name : Upload build artifacts # ÎπåÎìú Ï§ÄÎπÑ Îã®Í≥Ñ ÏóÖÎ°úÎìú ÌïòÍ∏∞ Ï†Ñ Îã®Í≥Ñ
        uses : actions/upload-artifact@v4
        with :
          name : build-artifacts
          path : dist/ # Í≤ΩÎ°ú

      - name : install ssh key
        run  : |
          mkdir -p ~/.ssh
          echo "${{ secrets.AWS_SECRET_KEY }}" > ~/.ssh/aws_key
          chmod 600 ~/.ssh/aws_key
          ssh-keyscan -H ${{ secrets.HOST }} >> ~/.ssh/known_hosts
          cat ~/.ssh/known_hosts

      - name : EC2 deploy
        uses : appleboy/ssh-action@v1.0.3
        with :
          host : ${{ secrets.HOST }}
          username : ${{ secrets.USERNAME }}
          key : ${{ secrets.AWS_SECRET_KEY }}
          port : ${{ secrets.PORT }}
          script : | # Ïã§ÌñâÌï† Ïä§ÌÅ¨Î¶ΩÌä∏ / | => Ï§Ñ ÎÇ¥Î¶º Í∏∞Ìò∏
            cd /home/ubuntu
            rm -rf dist
            mkdir dist

      - name : EC2Ïóê ÏïÑÌã∞Ìå©Ìä∏ ÎÇ¥Ïö© Î≥µÏÇ¨
        run  : |
          ls
          pwd
          scp -r -i ~/.ssh/aws_key ./dist/* ${{ secrets.USERNAME }}@${{ secrets.HOST }}:/home/ubuntu/dist/

      - name : deploy to EC2
        uses : appleboy/ssh-action@v1.0.3
        with :
          host : ${{ secrets.HOST }}
          username : ${{ secrets.USERNAME }}
          key : ${{ secrets.AWS_SECRET_KEY }}
          port : ${{ secrets.PORT }}
          script : |
            cd /home/ubuntu
            pm2 reload system.config.js --env production
```